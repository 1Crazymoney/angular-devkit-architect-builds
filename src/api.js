"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const rxjs_1 = require("rxjs");
const operators_1 = require("rxjs/operators");
const progress_schema_1 = require("./progress-schema");
exports.BuilderProgressState = progress_schema_1.State;
/**
 * Returns a string of "project:target[:configuration]" for the target object.
 */
function targetStringFromTarget({ project, target, configuration }) {
    return `${project}:${target}${configuration !== undefined ? ':' + configuration : ''}`;
}
exports.targetStringFromTarget = targetStringFromTarget;
/**
 * Return a Target tuple from a string.
 */
function targetFromTargetString(str) {
    const tuple = str.split(/:/, 3);
    if (tuple.length < 2) {
        throw new Error('Invalid target string: ' + JSON.stringify(str));
    }
    return Object.assign({ project: tuple[0], target: tuple[1] }, (tuple[2] !== undefined) && { configuration: tuple[2] });
}
exports.targetFromTargetString = targetFromTargetString;
/**
 * Schedule a target, and forget about its run. This will return an observable of outputs, that
 * as a a teardown will stop the target from running. This means that the Run object this returns
 * should not be shared.
 *
 * The reason this is not part of the Context interface is to keep the Context as normal form as
 * possible. This is really an utility that people would implement in their project.
 *
 * @param context The context of your current execution.
 * @param target The target to schedule.
 * @param overrides Overrides that are used in the target.
 * @param scheduleOptions Additional scheduling options.
 */
function scheduleTargetAndForget(context, target, overrides, scheduleOptions) {
    let resolve = null;
    const promise = new Promise(r => resolve = r);
    context.addTeardown(() => promise);
    return rxjs_1.from(context.scheduleTarget(target, overrides, scheduleOptions)).pipe(operators_1.switchMap(run => new rxjs_1.Observable(observer => {
        const subscription = run.output.subscribe(observer);
        return () => {
            subscription.unsubscribe();
            // We can properly ignore the floating promise as it's a "reverse" promise; the teardown
            // is waiting for the resolve.
            // tslint:disable-next-line:no-floating-promises
            run.stop().then(resolve);
        };
    })));
}
exports.scheduleTargetAndForget = scheduleTargetAndForget;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXBpLmpzIiwic291cmNlUm9vdCI6Ii4vIiwic291cmNlcyI6WyJwYWNrYWdlcy9hbmd1bGFyX2RldmtpdC9hcmNoaXRlY3Qvc3JjL2FwaS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQVFBLCtCQUF3QztBQUN4Qyw4Q0FBMkM7QUFHM0MsdURBQWlHO0FBSS9GLCtCQUorQyx1QkFBb0IsQ0FJL0M7QUFtUXRCOztHQUVHO0FBQ0gsU0FBZ0Isc0JBQXNCLENBQUMsRUFBQyxPQUFPLEVBQUUsTUFBTSxFQUFFLGFBQWEsRUFBUztJQUM3RSxPQUFPLEdBQUcsT0FBTyxJQUFJLE1BQU0sR0FBRyxhQUFhLEtBQUssU0FBUyxDQUFDLENBQUMsQ0FBQyxHQUFHLEdBQUcsYUFBYSxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQztBQUN6RixDQUFDO0FBRkQsd0RBRUM7QUFFRDs7R0FFRztBQUNILFNBQWdCLHNCQUFzQixDQUFDLEdBQVc7SUFDaEQsTUFBTSxLQUFLLEdBQUcsR0FBRyxDQUFDLEtBQUssQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDLENBQUM7SUFDaEMsSUFBSSxLQUFLLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTtRQUNwQixNQUFNLElBQUksS0FBSyxDQUFDLHlCQUF5QixHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztLQUNsRTtJQUVELHVCQUNFLE9BQU8sRUFBRSxLQUFLLENBQUMsQ0FBQyxDQUFDLEVBQ2pCLE1BQU0sRUFBRSxLQUFLLENBQUMsQ0FBQyxDQUFDLElBQ2IsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLEtBQUssU0FBUyxDQUFDLElBQUksRUFBRSxhQUFhLEVBQUUsS0FBSyxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQzFEO0FBQ0osQ0FBQztBQVhELHdEQVdDO0FBRUQ7Ozs7Ozs7Ozs7OztHQVlHO0FBQ0gsU0FBZ0IsdUJBQXVCLENBQ3JDLE9BQXVCLEVBQ3ZCLE1BQWMsRUFDZCxTQUEyQixFQUMzQixlQUFpQztJQUVqQyxJQUFJLE9BQU8sR0FBd0IsSUFBSSxDQUFDO0lBQ3hDLE1BQU0sT0FBTyxHQUFHLElBQUksT0FBTyxDQUFPLENBQUMsQ0FBQyxFQUFFLENBQUMsT0FBTyxHQUFHLENBQUMsQ0FBQyxDQUFDO0lBQ3BELE9BQU8sQ0FBQyxXQUFXLENBQUMsR0FBRyxFQUFFLENBQUMsT0FBTyxDQUFDLENBQUM7SUFFbkMsT0FBTyxXQUFJLENBQUMsT0FBTyxDQUFDLGNBQWMsQ0FBQyxNQUFNLEVBQUUsU0FBUyxFQUFFLGVBQWUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUMxRSxxQkFBUyxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsSUFBSSxpQkFBVSxDQUFnQixRQUFRLENBQUMsRUFBRTtRQUN4RCxNQUFNLFlBQVksR0FBRyxHQUFHLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUVwRCxPQUFPLEdBQUcsRUFBRTtZQUNWLFlBQVksQ0FBQyxXQUFXLEVBQUUsQ0FBQztZQUMzQix3RkFBd0Y7WUFDeEYsOEJBQThCO1lBQzlCLGdEQUFnRDtZQUNoRCxHQUFHLENBQUMsSUFBSSxFQUFFLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQzNCLENBQUMsQ0FBQztJQUNKLENBQUMsQ0FBQyxDQUFDLENBQ0osQ0FBQztBQUNKLENBQUM7QUF2QkQsMERBdUJDIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IEdvb2dsZSBJbmMuIEFsbCBSaWdodHMgUmVzZXJ2ZWQuXG4gKlxuICogVXNlIG9mIHRoaXMgc291cmNlIGNvZGUgaXMgZ292ZXJuZWQgYnkgYW4gTUlULXN0eWxlIGxpY2Vuc2UgdGhhdCBjYW4gYmVcbiAqIGZvdW5kIGluIHRoZSBMSUNFTlNFIGZpbGUgYXQgaHR0cHM6Ly9hbmd1bGFyLmlvL2xpY2Vuc2VcbiAqL1xuaW1wb3J0IHsgZXhwZXJpbWVudGFsLCBqc29uLCBsb2dnaW5nIH0gZnJvbSAnQGFuZ3VsYXItZGV2a2l0L2NvcmUnO1xuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgZnJvbSB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgc3dpdGNoTWFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHsgU2NoZW1hIGFzIFJlYWxCdWlsZGVySW5wdXQsIFRhcmdldCBhcyBSZWFsVGFyZ2V0IH0gZnJvbSAnLi9pbnB1dC1zY2hlbWEnO1xuaW1wb3J0IHsgU2NoZW1hIGFzIFJlYWxCdWlsZGVyT3V0cHV0IH0gZnJvbSAnLi9vdXRwdXQtc2NoZW1hJztcbmltcG9ydCB7IFNjaGVtYSBhcyBSZWFsQnVpbGRlclByb2dyZXNzLCBTdGF0ZSBhcyBCdWlsZGVyUHJvZ3Jlc3NTdGF0ZSB9IGZyb20gJy4vcHJvZ3Jlc3Mtc2NoZW1hJztcblxuZXhwb3J0IHR5cGUgVGFyZ2V0ID0ganNvbi5Kc29uT2JqZWN0ICYgUmVhbFRhcmdldDtcbmV4cG9ydCB7XG4gIEJ1aWxkZXJQcm9ncmVzc1N0YXRlLFxufTtcblxuLy8gVHlwZSBzaG9ydCBoYW5kcy5cbmV4cG9ydCB0eXBlIEJ1aWxkZXJSZWdpc3RyeSA9XG4gIGV4cGVyaW1lbnRhbC5qb2JzLlJlZ2lzdHJ5PGpzb24uSnNvbk9iamVjdCwgQnVpbGRlcklucHV0LCBCdWlsZGVyT3V0cHV0PjtcblxuXG4vKipcbiAqIEFuIEFQSSB0eXBlZCBCdWlsZGVyUHJvZ3Jlc3MuIFRoZSBpbnRlcmZhY2UgZ2VuZXJhdGVkIGZyb20gdGhlIHNjaGVtYSBpcyB0b28gcGVybWlzc2l2ZSxcbiAqIHNvIHRoaXMgQVBJIGlzIHRoZSBvbmUgd2Ugc2hvdyBpbiBvdXIgQVBJLiBQbGVhc2Ugbm90ZSB0aGF0IG5vdCBhbGwgZmllbGRzIGFyZSBpbiB0aGVyZTsgdGhpc1xuICogaXMgaW4gYWRkaXRpb24gdG8gZmllbGRzIGluIHRoZSBzY2hlbWEuXG4gKi9cbmV4cG9ydCB0eXBlIFR5cGVkQnVpbGRlclByb2dyZXNzID0gKFxuICAgIHsgc3RhdGU6IEJ1aWxkZXJQcm9ncmVzc1N0YXRlLlN0b3BwZWQ7IH1cbiAgfCB7IHN0YXRlOiBCdWlsZGVyUHJvZ3Jlc3NTdGF0ZS5FcnJvcjsgZXJyb3I6IGpzb24uSnNvblZhbHVlOyB9XG4gIHwgeyBzdGF0ZTogQnVpbGRlclByb2dyZXNzU3RhdGUuV2FpdGluZzsgc3RhdHVzPzogc3RyaW5nOyB9XG4gIHwgeyBzdGF0ZTogQnVpbGRlclByb2dyZXNzU3RhdGUuUnVubmluZzsgc3RhdHVzPzogc3RyaW5nOyBjdXJyZW50OiBudW1iZXI7IHRvdGFsPzogbnVtYmVyOyB9XG4pO1xuXG4vKipcbiAqIERlY2xhcmF0aW9uIG9mIHRob3NlIHR5cGVzIGFzIEpzb25PYmplY3QgY29tcGF0aWJsZS4gSnNvbk9iamVjdCBpcyBub3QgY29tcGF0aWJsZSB3aXRoXG4gKiBvcHRpb25hbCBtZW1iZXJzLCBzbyB0aG9zZSB3b3VsZG4ndCBiZSBkaXJlY3RseSBhc3NpZ25hYmxlIHRvIG91ciBpbnRlcm5hbCBKc29uIHR5cGluZ3MuXG4gKiBGb3JjaW5nIHRoZSB0eXBlIHRvIGJlIGJvdGggYSBKc29uT2JqZWN0IGFuZCB0aGUgdHlwZSBmcm9tIHRoZSBTY2hlbWEgdGVsbHMgVHlwZXNjcmlwdCB0aGV5XG4gKiBhcmUgY29tcGF0aWJsZSAod2hpY2ggdGhleSBhcmUpLlxuICogVGhlc2UgdHlwZXMgc2hvdWxkIGJlIHVzZWQgZXZlcnl3aGVyZS5cbiAqL1xuZXhwb3J0IHR5cGUgQnVpbGRlcklucHV0ID0ganNvbi5Kc29uT2JqZWN0ICYgUmVhbEJ1aWxkZXJJbnB1dDtcbmV4cG9ydCB0eXBlIEJ1aWxkZXJPdXRwdXQgPSBqc29uLkpzb25PYmplY3QgJiBSZWFsQnVpbGRlck91dHB1dDtcbmV4cG9ydCB0eXBlIEJ1aWxkZXJQcm9ncmVzcyA9IGpzb24uSnNvbk9iamVjdCAmIFJlYWxCdWlsZGVyUHJvZ3Jlc3MgJiBUeXBlZEJ1aWxkZXJQcm9ncmVzcztcblxuLyoqXG4gKiBBIHByb2dyZXNzIHJlcG9ydCBpcyB3aGF0IHRoZSB0b29saW5nIHdpbGwgcmVjZWl2ZS4gSXQgY29udGFpbnMgdGhlIGJ1aWxkZXIgaW5mbyBhbmQgdGhlIHRhcmdldC5cbiAqIEFsdGhvdWdoIHRoZXNlIGFyZSBzZXJpYWxpemFibGUsIHRoZXkgYXJlIG9ubHkgZXhwb3NlZCB0aHJvdWdoIHRoZSB0b29saW5nIGludGVyZmFjZSwgbm90IHRoZVxuICogYnVpbGRlciBpbnRlcmZhY2UuIFRoZSB3YXRjaCBkb2cgc2VuZHMgQnVpbGRlclByb2dyZXNzIGFuZCB0aGUgQnVpbGRlciBoYXMgYSBzZXQgb2YgZnVuY3Rpb25zXG4gKiB0byBtYW5hZ2UgdGhlIHN0YXRlLlxuICovXG5leHBvcnQgdHlwZSBCdWlsZGVyUHJvZ3Jlc3NSZXBvcnQgPSBCdWlsZGVyUHJvZ3Jlc3MgJiAoe1xuICB0YXJnZXQ/OiBUYXJnZXQ7XG4gIGJ1aWxkZXI6IEJ1aWxkZXJJbmZvO1xufSk7XG5cbi8qKlxuICogQSBSdW4sIHdoaWNoIGlzIHdoYXQgaXMgcmV0dXJuZWQgYnkgc2NoZWR1bGVCdWlsZGVyIG9yIHNjaGVkdWxlVGFyZ2V0IGZ1bmN0aW9ucy4gVGhpcyBzaG91bGRcbiAqIGJlIHJlY29uc3RydWN0ZWQgYWNyb3NzIG1lbW9yeSBib3VuZGFyaWVzIChpdCdzIG5vdCBzZXJpYWxpemFibGUgYnV0IGFsbCBpbnRlcm5hbCBpbmZvcm1hdGlvblxuICogYXJlKS5cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBCdWlsZGVyUnVuIHtcbiAgLyoqXG4gICAqIFVuaXF1ZSBhbW9uZ3N0IHJ1bnMuIFRoaXMgaXMgdGhlIHNhbWUgSUQgYXMgdGhlIGNvbnRleHQgZ2VuZXJhdGVkIGZvciB0aGUgcnVuLiBJdCBjYW4gYmVcbiAgICogdXNlZCB0byBpZGVudGlmeSBtdWx0aXBsZSB1bmlxdWUgcnVucy4gVGhlcmUgaXMgbm8gZ3VhcmFudGVlIHRoYXQgYSBydW4gaXMgYSBzaW5nbGUgb3V0cHV0O1xuICAgKiBhIGJ1aWxkZXIgY2FuIHJlYnVpbGQgb24gaXRzIG93biBhbmQgd2lsbCBnZW5lcmF0ZSBtdWx0aXBsZSBvdXRwdXRzLlxuICAgKi9cbiAgaWQ6IG51bWJlcjtcblxuICAvKipcbiAgICogVGhlIGJ1aWxkZXIgaW5mb3JtYXRpb24uXG4gICAqL1xuICBpbmZvOiBCdWlsZGVySW5mbztcblxuICAvKipcbiAgICogVGhlIG5leHQgb3V0cHV0IGZyb20gYSBidWlsZGVyLiBUaGlzIGlzIHJlY29tbWVuZGVkIHdoZW4gc2NoZWR1bGluZyBhIGJ1aWxkZXIgYW5kIG9ubHkgYmVpbmdcbiAgICogaW50ZXJlc3RlZCBpbiB0aGUgcmVzdWx0IG9mIHRoYXQgc2luZ2xlIHJ1biwgbm90IG9mIGEgd2F0Y2gtbW9kZSBidWlsZGVyLlxuICAgKi9cbiAgcmVzdWx0OiBQcm9taXNlPEJ1aWxkZXJPdXRwdXQ+O1xuXG4gIC8qKlxuICAgKiBUaGUgb3V0cHV0KHMpIGZyb20gdGhlIGJ1aWxkZXIuIEEgYnVpbGRlciBjYW4gaGF2ZSBtdWx0aXBsZSBvdXRwdXRzLlxuICAgKiBUaGlzIGFsd2F5cyByZXBsYXkgdGhlIGxhc3Qgb3V0cHV0IHdoZW4gc3Vic2NyaWJlZC5cbiAgICovXG4gIG91dHB1dDogT2JzZXJ2YWJsZTxCdWlsZGVyT3V0cHV0PjtcblxuICAvKipcbiAgICogVGhlIHByb2dyZXNzIHJlcG9ydC4gQSBwcm9ncmVzcyBhbHNvIGNvbnRhaW5zIGFuIElELCB3aGljaCBjYW4gYmUgZGlmZmVyZW50IHRoYW4gdGhpcyBydW4nc1xuICAgKiBJRCAoaWYgdGhlIGJ1aWxkZXIgY2FsbHMgc2NoZWR1bGVCdWlsZGVyIG9yIHNjaGVkdWxlVGFyZ2V0KS5cbiAgICogVGhpcyB3aWxsIGFsd2F5cyByZXBsYXkgdGhlIGxhc3QgcHJvZ3Jlc3Mgb24gbmV3IHN1YnNjcmlwdGlvbnMuXG4gICAqL1xuICBwcm9ncmVzczogT2JzZXJ2YWJsZTxCdWlsZGVyUHJvZ3Jlc3NSZXBvcnQ+O1xuXG4gIC8qKlxuICAgKiBTdG9wIHRoZSBidWlsZGVyIGZyb20gcnVubmluZy4gUmV0dXJucyBhIHByb21pc2UgdGhhdCByZXNvbHZlcyB3aGVuIHRoZSBidWlsZGVyIGlzIHN0b3BwZWQuXG4gICAqIFNvbWUgYnVpbGRlcnMgbWlnaHQgbm90IGhhbmRsZSBzdG9wcGluZyBwcm9wZXJseSBhbmQgc2hvdWxkIGhhdmUgYSB0aW1lb3V0IGhlcmUuXG4gICAqL1xuICBzdG9wKCk6IFByb21pc2U8dm9pZD47XG59XG5cbi8qKlxuICogQWRkaXRpb25hbCBvcHRpb25hbCBzY2hlZHVsaW5nIG9wdGlvbnMuXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgU2NoZWR1bGVPcHRpb25zIHtcbiAgLyoqXG4gICAqIExvZ2dlciB0byBwYXNzIHRvIHRoZSBidWlsZGVyLiBOb3RlIHRoYXQgbWVzc2FnZXMgd2lsbCBzdG9wIGJlaW5nIGZvcndhcmRlZCwgYW5kIGlmIHlvdSB3YW50XG4gICAqIHRvIGxvZyBhIGJ1aWxkZXIgc2NoZWR1bGVkIGZyb20geW91ciBidWlsZGVyIHlvdSBzaG91bGQgZm9yd2FyZCBsb2cgZXZlbnRzIHlvdXJzZWxmLlxuICAgKi9cbiAgbG9nZ2VyPzogbG9nZ2luZy5Mb2dnZXI7XG59XG5cbi8qKlxuICogVGhlIGNvbnRleHQgcmVjZWl2ZWQgYXMgYSBzZWNvbmQgYXJndW1lbnQgaW4geW91ciBidWlsZGVyLlxuICovXG5leHBvcnQgaW50ZXJmYWNlIEJ1aWxkZXJDb250ZXh0IHtcbiAgLyoqXG4gICAqIFVuaXF1ZSBhbW9uZ3N0IGNvbnRleHRzLiBDb250ZXh0cyBpbnN0YW5jZXMgYXJlIG5vdCBndWFyYW50ZWVkIHRvIGJlIHRoZSBzYW1lIChidXQgaXQgY291bGRcbiAgICogYmUgdGhlIHNhbWUgY29udGV4dCksIGFuZCBhbGwgdGhlIGZpZWxkcyBpbiBhIGNvbnRleHQgY291bGQgYmUgdGhlIHNhbWUsIHlldCB0aGUgYnVpbGRlcidzXG4gICAqIGNvbnRleHQgY291bGQgYmUgZGlmZmVyZW50LiBUaGlzIGlzIHRoZSBzYW1lIElEIGFzIHRoZSBjb3JyZXNwb25kaW5nIHJ1bi5cbiAgICovXG4gIGlkOiBudW1iZXI7XG5cbiAgLyoqXG4gICAqIFRoZSBidWlsZGVyIGluZm8gdGhhdCBjYWxsZWQgeW91ciBmdW5jdGlvbi4gU2luY2UgdGhlIGJ1aWxkZXIgaW5mbyBpcyBmcm9tIHRoZSBidWlsZGVyLmpzb25cbiAgICogKG9yIHRoZSBob3N0KSwgaXQgY291bGQgY29udGFpbiBpbmZvcm1hdGlvbiB0aGF0IGlzIGRpZmZlcmVudCB0aGFuIGV4cGVjdGVkLlxuICAgKi9cbiAgYnVpbGRlcjogQnVpbGRlckluZm87XG5cbiAgLyoqXG4gICAqIEEgbG9nZ2VyIHRoYXQgYXBwZW5kcyBtZXNzYWdlcyB0byBhIGxvZy4gVGhpcyBjb3VsZCBiZSBhIHNlcGFyYXRlIGludGVyZmFjZSBvciBjb21wbGV0ZWx5XG4gICAqIGlnbm9yZWQuIGBjb25zb2xlLmxvZ2AgY291bGQgYWxzbyBiZSBjb21wbGV0ZWx5IGlnbm9yZWQuXG4gICAqL1xuICBsb2dnZXI6IGxvZ2dpbmcuTG9nZ2VyQXBpO1xuXG4gIC8qKlxuICAgKiBUaGUgYWJzb2x1dGUgd29ya3NwYWNlIHJvb3Qgb2YgdGhpcyBydW4uIFRoaXMgaXMgYSBzeXN0ZW0gcGF0aCBhbmQgd2lsbCBub3QgYmUgbm9ybWFsaXplZDtcbiAgICogaWUuIG9uIFdpbmRvd3MgaXQgd2lsbCBzdGFydHMgd2l0aCBgQzpcXFxcYCAob3Igd2hhdGV2ZXIgZHJpdmUpLlxuICAgKi9cbiAgd29ya3NwYWNlUm9vdDogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBUaGUgY3VycmVudCBkaXJlY3RvcnkgdGhlIHVzZXIgaXMgaW4uIFRoaXMgY291bGQgYmUgb3V0c2lkZSB0aGUgd29ya3NwYWNlIHJvb3QuIFRoaXMgaXMgYVxuICAgKiBzeXN0ZW0gcGF0aCBhbmQgd2lsbCBub3QgYmUgbm9ybWFsaXplZDsgaWUuIG9uIFdpbmRvd3MgaXQgd2lsbCBzdGFydHMgd2l0aCBgQzpcXFxcYCAob3JcbiAgICogd2hhdGV2ZXIgZHJpdmUpLlxuICAgKi9cbiAgY3VycmVudERpcmVjdG9yeTogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBUaGUgdGFyZ2V0IHRoYXQgd2FzIHVzZWQgdG8gcnVuIHRoaXMgYnVpbGRlci5cbiAgICogVGFyZ2V0IGlzIG9wdGlvbmFsIGlmIGEgYnVpbGRlciB3YXMgcmFuIHVzaW5nIGBzY2hlZHVsZUJ1aWxkZXIoKWAuXG4gICAqL1xuICB0YXJnZXQ/OiBUYXJnZXQ7XG5cbiAgLyoqXG4gICAqIFNjaGVkdWxlIGEgdGFyZ2V0IGluIHRoZSBzYW1lIHdvcmtzcGFjZS4gVGhpcyBjYW4gYmUgdGhlIHNhbWUgdGFyZ2V0IHRoYXQgaXMgYmVpbmcgZXhlY3V0ZWRcbiAgICogcmlnaHQgbm93LCBidXQgdGFyZ2V0cyBvZiB0aGUgc2FtZSBuYW1lIGFyZSBzZXJpYWxpemVkLlxuICAgKiBSdW5uaW5nIHRoZSBzYW1lIHRhcmdldCBhbmQgd2FpdGluZyBmb3IgaXQgdG8gZW5kIHdpbGwgcmVzdWx0IGluIGEgZGVhZGxvY2tpbmcgc2NlbmFyaW8uXG4gICAqIFRhcmdldHMgYXJlIGNvbnNpZGVyZWQgdGhlIHNhbWUgaWYgdGhlIHByb2plY3QsIHRoZSB0YXJnZXQgQU5EIHRoZSBjb25maWd1cmF0aW9uIGFyZSB0aGUgc2FtZS5cbiAgICogQHBhcmFtIHRhcmdldCBUaGUgdGFyZ2V0IHRvIHNjaGVkdWxlLlxuICAgKiBAcGFyYW0gb3ZlcnJpZGVzIEEgc2V0IG9mIG9wdGlvbnMgdG8gb3ZlcnJpZGUgdGhlIHdvcmtzcGFjZSBzZXQgb2Ygb3B0aW9ucy5cbiAgICogQHBhcmFtIHNjaGVkdWxlT3B0aW9ucyBBZGRpdGlvbmFsIG9wdGlvbmFsIHNjaGVkdWxpbmcgb3B0aW9ucy5cbiAgICogQHJldHVybiBBIHByb21pc2Ugb2YgYSBydW4uIEl0IHdpbGwgcmVzb2x2ZSB3aGVuIGFsbCB0aGUgbWVtYmVycyBvZiB0aGUgcnVuIGFyZSBhdmFpbGFibGUuXG4gICAqL1xuICBzY2hlZHVsZVRhcmdldChcbiAgICB0YXJnZXQ6IFRhcmdldCxcbiAgICBvdmVycmlkZXM/OiBqc29uLkpzb25PYmplY3QsXG4gICAgc2NoZWR1bGVPcHRpb25zPzogU2NoZWR1bGVPcHRpb25zLFxuICApOiBQcm9taXNlPEJ1aWxkZXJSdW4+O1xuXG4gIC8qKlxuICAgKiBTY2hlZHVsZSBhIGJ1aWxkZXIgYnkgaXRzIG5hbWUuIFRoaXMgY2FuIGJlIHRoZSBzYW1lIGJ1aWxkZXIgdGhhdCBpcyBiZWluZyBleGVjdXRlZC5cbiAgICogQHBhcmFtIGJ1aWxkZXJOYW1lIFRoZSBuYW1lIG9mIHRoZSBidWlsZGVyLCBpZS4gaXRzIGBwYWNrYWdlTmFtZTpidWlsZGVyTmFtZWAgdHVwbGUuXG4gICAqIEBwYXJhbSBvcHRpb25zIEFsbCBvcHRpb25zIHRvIHVzZSBmb3IgdGhlIGJ1aWxkZXIgKGJ5IGRlZmF1bHQgZW1wdHkgb2JqZWN0KS4gVGhlcmUgaXMgbm9cbiAgICogICAgIGFkZGl0aW9uYWwgb3B0aW9ucyBhZGRlZCwgZS5nLiBmcm9tIHRoZSB3b3Jrc3BhY2UuXG4gICAqIEBwYXJhbSBzY2hlZHVsZU9wdGlvbnMgQWRkaXRpb25hbCBvcHRpb25hbCBzY2hlZHVsaW5nIG9wdGlvbnMuXG4gICAqIEByZXR1cm4gQSBwcm9taXNlIG9mIGEgcnVuLiBJdCB3aWxsIHJlc29sdmUgd2hlbiBhbGwgdGhlIG1lbWJlcnMgb2YgdGhlIHJ1biBhcmUgYXZhaWxhYmxlLlxuICAgKi9cbiAgc2NoZWR1bGVCdWlsZGVyKFxuICAgIGJ1aWxkZXJOYW1lOiBzdHJpbmcsXG4gICAgb3B0aW9ucz86IGpzb24uSnNvbk9iamVjdCxcbiAgICBzY2hlZHVsZU9wdGlvbnM/OiBTY2hlZHVsZU9wdGlvbnMsXG4gICk6IFByb21pc2U8QnVpbGRlclJ1bj47XG5cbiAgLyoqXG4gICAqIFJlc29sdmUgYW5kIHJldHVybiBvcHRpb25zIGZvciBhIHNwZWNpZmllZCB0YXJnZXQuIElmIHRoZSB0YXJnZXQgaXNuJ3QgZGVmaW5lZCBpbiB0aGVcbiAgICogd29ya3NwYWNlIHRoaXMgd2lsbCByZWplY3QgdGhlIHByb21pc2UuIFRoaXMgb2JqZWN0IHdpbGwgYmUgcmVhZCBkaXJlY3RseSBmcm9tIHRoZSB3b3Jrc3BhY2VcbiAgICogYnV0IG5vdCB2YWxpZGF0ZWQgYWdhaW5zdCB0aGUgYnVpbGRlciBvZiB0aGUgdGFyZ2V0LlxuICAgKiBAcGFyYW0gdGFyZ2V0IFRoZSB0YXJnZXQgdG8gcmVzb2x2ZSB0aGUgb3B0aW9ucyBvZi5cbiAgICogQHJldHVybiBBIG5vbi12YWxpZGF0ZWQgb2JqZWN0IHJlc29sdmVkIGZyb20gdGhlIHdvcmtzcGFjZS5cbiAgICovXG4gIGdldFRhcmdldE9wdGlvbnModGFyZ2V0OiBUYXJnZXQpOiBQcm9taXNlPGpzb24uSnNvbk9iamVjdD47XG5cbiAgLyoqXG4gICAqIFJlc29sdmVzIGFuZCByZXR1cm4gYSBidWlsZGVyIG5hbWUuIFRoZSBleGFjdCBmb3JtYXQgb2YgdGhlIG5hbWUgaXMgdXAgdG8gdGhlIGhvc3QsXG4gICAqIHNvIGl0IHNob3VsZCBub3QgYmUgcGFyc2VkIHRvIGdhdGhlciBpbmZvcm1hdGlvbiAoaXQncyBmcmVlIGZvcm0pLiBUaGlzIHN0cmluZyBjYW4gYmVcbiAgICogdXNlZCB0byB2YWxpZGF0ZSBvcHRpb25zIG9yIHNjaGVkdWxlIGEgYnVpbGRlciBkaXJlY3RseS5cbiAgICogQHBhcmFtIHRhcmdldCBUaGUgdGFyZ2V0IHRvIHJlc29sdmUgdGhlIGJ1aWxkZXIgbmFtZS5cbiAgICovXG4gIGdldEJ1aWxkZXJOYW1lRm9yVGFyZ2V0KHRhcmdldDogVGFyZ2V0KTogUHJvbWlzZTxzdHJpbmc+O1xuXG4gIC8qKlxuICAgKiBWYWxpZGF0ZXMgdGhlIG9wdGlvbnMgYWdhaW5zdCBhIGJ1aWxkZXIgc2NoZW1hLiBUaGlzIHVzZXMgdGhlIHNhbWUgbWV0aG9kcyBhcyB0aGVcbiAgICogc2NoZWR1bGVUYXJnZXQgYW5kIHNjaGVkdWxlQnJvd3NlciBtZXRob2RzIHRvIHZhbGlkYXRlIGFuZCBhcHBseSBkZWZhdWx0cyB0byB0aGUgb3B0aW9ucy5cbiAgICogSXQgY2FuIGJlIGdlbmVyaWNhbGx5IHR5cGVkLCBpZiB5b3Uga25vdyB3aGljaCBpbnRlcmZhY2UgaXQgaXMgc3VwcG9zZWQgdG8gdmFsaWRhdGUgYWdhaW5zdC5cbiAgICogQHBhcmFtIG9wdGlvbnMgQSBnZW5lcmljIG9wdGlvbiBvYmplY3QgdG8gdmFsaWRhdGUuXG4gICAqIEBwYXJhbSBidWlsZGVyTmFtZSBUaGUgbmFtZSBvZiBhIGJ1aWxkZXIgdG8gdXNlLiBUaGlzIGNhbiBiZSBnb3R0ZW4gZm9yIGEgdGFyZ2V0IGJ5IHVzaW5nIHRoZVxuICAgKiAgICAgICAgICAgICAgICAgICAgZ2V0QnVpbGRlckZvclRhcmdldCgpIG1ldGhvZCBvbiB0aGUgY29udGV4dC5cbiAgICovXG4gIHZhbGlkYXRlT3B0aW9uczxUIGV4dGVuZHMganNvbi5Kc29uT2JqZWN0ID0ganNvbi5Kc29uT2JqZWN0PihcbiAgICBvcHRpb25zOiBqc29uLkpzb25PYmplY3QsXG4gICAgYnVpbGRlck5hbWU6IHN0cmluZyxcbiAgKTogUHJvbWlzZTxUPjtcblxuICAvKipcbiAgICogU2V0IHRoZSBidWlsZGVyIHRvIHJ1bm5pbmcuIFRoaXMgc2hvdWxkIGJlIHVzZWQgaWYgYW4gZXh0ZXJuYWwgZXZlbnQgdHJpZ2dlcmVkIGEgcmUtcnVuLFxuICAgKiBlLmcuIGEgZmlsZSB3YXRjaGVkIHdhcyBjaGFuZ2VkLlxuICAgKi9cbiAgcmVwb3J0UnVubmluZygpOiB2b2lkO1xuXG4gIC8qKlxuICAgKiBVcGRhdGUgdGhlIHN0YXR1cyBzdHJpbmcgc2hvd24gb24gdGhlIGludGVyZmFjZS5cbiAgICogQHBhcmFtIHN0YXR1cyBUaGUgc3RhdHVzIHRvIHNldCBpdCB0by4gQW4gZW1wdHkgc3RyaW5nIGNhbiBiZSB1c2VkIHRvIHJlbW92ZSB0aGUgc3RhdHVzLlxuICAgKi9cbiAgcmVwb3J0U3RhdHVzKHN0YXR1czogc3RyaW5nKTogdm9pZDtcblxuICAvKipcbiAgICogVXBkYXRlIHRoZSBwcm9ncmVzcyBmb3IgdGhpcyBidWlsZGVyIHJ1bi5cbiAgICogQHBhcmFtIGN1cnJlbnQgVGhlIGN1cnJlbnQgcHJvZ3Jlc3MuIFRoaXMgd2lsbCBiZSBiZXR3ZWVuIDAgYW5kIHRvdGFsLlxuICAgKiBAcGFyYW0gdG90YWwgQSBuZXcgdG90YWwgdG8gc2V0LiBCeSBkZWZhdWx0IGF0IHRoZSBzdGFydCBvZiBhIHJ1biB0aGlzIGlzIDEuIElmIG9taXR0ZWQgaXRcbiAgICogICAgIHdpbGwgdXNlIHRoZSBzYW1lIHZhbHVlIGFzIHRoZSBsYXN0IHRvdGFsLlxuICAgKiBAcGFyYW0gc3RhdHVzIFVwZGF0ZSB0aGUgc3RhdHVzIHN0cmluZy4gSWYgb21pdHRlZCB0aGUgc3RhdHVzIHN0cmluZyBpcyBub3QgbW9kaWZpZWQuXG4gICAqL1xuICByZXBvcnRQcm9ncmVzcyhjdXJyZW50OiBudW1iZXIsIHRvdGFsPzogbnVtYmVyLCBzdGF0dXM/OiBzdHJpbmcpOiB2b2lkO1xuXG4gIC8qKlxuICAgKiBBZGQgdGVhcmRvd24gbG9naWMgdG8gdGhpcyBDb250ZXh0LCBzbyB0aGF0IHdoZW4gaXQncyBiZWluZyBzdG9wcGVkIGl0IHdpbGwgZXhlY3V0ZSB0ZWFyZG93bi5cbiAgICovXG4gIGFkZFRlYXJkb3duKHRlYXJkb3duOiAoKSA9PiAoUHJvbWlzZTx2b2lkPiB8IHZvaWQpKTogdm9pZDtcbn1cblxuXG4vKipcbiAqIEFuIGFjY2VwdGVkIHJldHVybiB2YWx1ZSBmcm9tIGEgYnVpbGRlci4gQ2FuIGJlIGVpdGhlciBhbiBPYnNlcnZhYmxlLCBhIFByb21pc2Ugb3IgYSB2ZWN0b3IuXG4gKi9cbmV4cG9ydCB0eXBlIEJ1aWxkZXJPdXRwdXRMaWtlID0gT2JzZXJ2YWJsZTxCdWlsZGVyT3V0cHV0PiB8IFByb21pc2U8QnVpbGRlck91dHB1dD4gfCBCdWlsZGVyT3V0cHV0O1xuXG5cbi8qKlxuICogQSBidWlsZGVyIGhhbmRsZXIgZnVuY3Rpb24uIFRoZSBmdW5jdGlvbiBzaWduYXR1cmUgcGFzc2VkIHRvIGBjcmVhdGVCdWlsZGVyKClgLlxuICovXG5leHBvcnQgaW50ZXJmYWNlIEJ1aWxkZXJIYW5kbGVyRm48QSBleHRlbmRzIGpzb24uSnNvbk9iamVjdD4ge1xuICAvKipcbiAgICogQnVpbGRlcnMgYXJlIGRlZmluZWQgYnkgdXNlcnMgdG8gcGVyZm9ybSBhbnkga2luZCBvZiB0YXNrLCBsaWtlIGJ1aWxkaW5nLCB0ZXN0aW5nIG9yIGxpbnRpbmcsXG4gICAqIGFuZCBzaG91bGQgdXNlIHRoaXMgaW50ZXJmYWNlLlxuICAgKiBAcGFyYW0gaW5wdXQgVGhlIG9wdGlvbnMgKGEgSnNvbk9iamVjdCksIHZhbGlkYXRlZCBieSB0aGUgc2NoZW1hIGFuZCByZWNlaXZlZCBieSB0aGVcbiAgICogICAgIGJ1aWxkZXIuIFRoaXMgY2FuIGluY2x1ZGUgcmVzb2x2ZWQgb3B0aW9ucyBmcm9tIHRoZSBDTEkgb3IgdGhlIHdvcmtzcGFjZS5cbiAgICogQHBhcmFtIGNvbnRleHQgQSBjb250ZXh0IHRoYXQgY2FuIGJlIHVzZWQgdG8gaW50ZXJhY3Qgd2l0aCB0aGUgQXJjaGl0ZWN0IGZyYW1ld29yay5cbiAgICogQHJldHVybiBPbmUgb3IgbWFueSBidWlsZGVyIG91dHB1dC5cbiAgICovXG4gIChpbnB1dDogQSwgY29udGV4dDogQnVpbGRlckNvbnRleHQpOiBCdWlsZGVyT3V0cHV0TGlrZTtcbn1cblxuLyoqXG4gKiBBIEJ1aWxkZXIgZ2VuZXJhbCBpbmZvcm1hdGlvbi4gVGhpcyBpcyBnZW5lcmF0ZWQgYnkgdGhlIGhvc3QgYW5kIGlzIGV4cGFuZGVkIGJ5IHRoZSBob3N0LCBidXRcbiAqIHRoZSBwdWJsaWMgQVBJIGNvbnRhaW5zIHRob3NlIGZpZWxkcy5cbiAqL1xuZXhwb3J0IHR5cGUgQnVpbGRlckluZm8gPSBqc29uLkpzb25PYmplY3QgJiB7XG4gIGJ1aWxkZXJOYW1lOiBzdHJpbmc7XG4gIGRlc2NyaXB0aW9uOiBzdHJpbmc7XG4gIG9wdGlvblNjaGVtYToganNvbi5zY2hlbWEuSnNvblNjaGVtYTtcbn07XG5cblxuLyoqXG4gKiBSZXR1cm5zIGEgc3RyaW5nIG9mIFwicHJvamVjdDp0YXJnZXRbOmNvbmZpZ3VyYXRpb25dXCIgZm9yIHRoZSB0YXJnZXQgb2JqZWN0LlxuICovXG5leHBvcnQgZnVuY3Rpb24gdGFyZ2V0U3RyaW5nRnJvbVRhcmdldCh7cHJvamVjdCwgdGFyZ2V0LCBjb25maWd1cmF0aW9ufTogVGFyZ2V0KSB7XG4gIHJldHVybiBgJHtwcm9qZWN0fToke3RhcmdldH0ke2NvbmZpZ3VyYXRpb24gIT09IHVuZGVmaW5lZCA/ICc6JyArIGNvbmZpZ3VyYXRpb24gOiAnJ31gO1xufVxuXG4vKipcbiAqIFJldHVybiBhIFRhcmdldCB0dXBsZSBmcm9tIGEgc3RyaW5nLlxuICovXG5leHBvcnQgZnVuY3Rpb24gdGFyZ2V0RnJvbVRhcmdldFN0cmluZyhzdHI6IHN0cmluZyk6IFRhcmdldCB7XG4gIGNvbnN0IHR1cGxlID0gc3RyLnNwbGl0KC86LywgMyk7XG4gIGlmICh0dXBsZS5sZW5ndGggPCAyKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIHRhcmdldCBzdHJpbmc6ICcgKyBKU09OLnN0cmluZ2lmeShzdHIpKTtcbiAgfVxuXG4gIHJldHVybiB7XG4gICAgcHJvamVjdDogdHVwbGVbMF0sXG4gICAgdGFyZ2V0OiB0dXBsZVsxXSxcbiAgICAuLi4odHVwbGVbMl0gIT09IHVuZGVmaW5lZCkgJiYgeyBjb25maWd1cmF0aW9uOiB0dXBsZVsyXSB9LFxuICB9O1xufVxuXG4vKipcbiAqIFNjaGVkdWxlIGEgdGFyZ2V0LCBhbmQgZm9yZ2V0IGFib3V0IGl0cyBydW4uIFRoaXMgd2lsbCByZXR1cm4gYW4gb2JzZXJ2YWJsZSBvZiBvdXRwdXRzLCB0aGF0XG4gKiBhcyBhIGEgdGVhcmRvd24gd2lsbCBzdG9wIHRoZSB0YXJnZXQgZnJvbSBydW5uaW5nLiBUaGlzIG1lYW5zIHRoYXQgdGhlIFJ1biBvYmplY3QgdGhpcyByZXR1cm5zXG4gKiBzaG91bGQgbm90IGJlIHNoYXJlZC5cbiAqXG4gKiBUaGUgcmVhc29uIHRoaXMgaXMgbm90IHBhcnQgb2YgdGhlIENvbnRleHQgaW50ZXJmYWNlIGlzIHRvIGtlZXAgdGhlIENvbnRleHQgYXMgbm9ybWFsIGZvcm0gYXNcbiAqIHBvc3NpYmxlLiBUaGlzIGlzIHJlYWxseSBhbiB1dGlsaXR5IHRoYXQgcGVvcGxlIHdvdWxkIGltcGxlbWVudCBpbiB0aGVpciBwcm9qZWN0LlxuICpcbiAqIEBwYXJhbSBjb250ZXh0IFRoZSBjb250ZXh0IG9mIHlvdXIgY3VycmVudCBleGVjdXRpb24uXG4gKiBAcGFyYW0gdGFyZ2V0IFRoZSB0YXJnZXQgdG8gc2NoZWR1bGUuXG4gKiBAcGFyYW0gb3ZlcnJpZGVzIE92ZXJyaWRlcyB0aGF0IGFyZSB1c2VkIGluIHRoZSB0YXJnZXQuXG4gKiBAcGFyYW0gc2NoZWR1bGVPcHRpb25zIEFkZGl0aW9uYWwgc2NoZWR1bGluZyBvcHRpb25zLlxuICovXG5leHBvcnQgZnVuY3Rpb24gc2NoZWR1bGVUYXJnZXRBbmRGb3JnZXQoXG4gIGNvbnRleHQ6IEJ1aWxkZXJDb250ZXh0LFxuICB0YXJnZXQ6IFRhcmdldCxcbiAgb3ZlcnJpZGVzPzoganNvbi5Kc29uT2JqZWN0LFxuICBzY2hlZHVsZU9wdGlvbnM/OiBTY2hlZHVsZU9wdGlvbnMsXG4pOiBPYnNlcnZhYmxlPEJ1aWxkZXJPdXRwdXQ+IHtcbiAgbGV0IHJlc29sdmU6ICgoKSA9PiB2b2lkKSB8IG51bGwgPSBudWxsO1xuICBjb25zdCBwcm9taXNlID0gbmV3IFByb21pc2U8dm9pZD4ociA9PiByZXNvbHZlID0gcik7XG4gIGNvbnRleHQuYWRkVGVhcmRvd24oKCkgPT4gcHJvbWlzZSk7XG5cbiAgcmV0dXJuIGZyb20oY29udGV4dC5zY2hlZHVsZVRhcmdldCh0YXJnZXQsIG92ZXJyaWRlcywgc2NoZWR1bGVPcHRpb25zKSkucGlwZShcbiAgICBzd2l0Y2hNYXAocnVuID0+IG5ldyBPYnNlcnZhYmxlPEJ1aWxkZXJPdXRwdXQ+KG9ic2VydmVyID0+IHtcbiAgICAgIGNvbnN0IHN1YnNjcmlwdGlvbiA9IHJ1bi5vdXRwdXQuc3Vic2NyaWJlKG9ic2VydmVyKTtcblxuICAgICAgcmV0dXJuICgpID0+IHtcbiAgICAgICAgc3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gICAgICAgIC8vIFdlIGNhbiBwcm9wZXJseSBpZ25vcmUgdGhlIGZsb2F0aW5nIHByb21pc2UgYXMgaXQncyBhIFwicmV2ZXJzZVwiIHByb21pc2U7IHRoZSB0ZWFyZG93blxuICAgICAgICAvLyBpcyB3YWl0aW5nIGZvciB0aGUgcmVzb2x2ZS5cbiAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm5vLWZsb2F0aW5nLXByb21pc2VzXG4gICAgICAgIHJ1bi5zdG9wKCkudGhlbihyZXNvbHZlKTtcbiAgICAgIH07XG4gICAgfSkpLFxuICApO1xufVxuIl19